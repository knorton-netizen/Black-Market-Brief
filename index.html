<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Black Market Brief</title>

  <!-- Favicons -->
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root{
      --blue:#1b4cff;
      --red:#d61f2c;
      --muted:#333;
      --thin:#e9e9e9;
    }

    body{
      background:#fff;
      color:#000;
      font-family:Arial, Helvetica, sans-serif;
      margin:0;
      padding:14px 12px;
      max-width:900px;
      margin-left:auto;
      margin-right:auto;
      -webkit-text-size-adjust:100%;
    }

    h1{
      text-align:center;
      font-size:42px;
      font-weight:900;
      text-transform:uppercase;
      letter-spacing:3px;
      font-style:italic;
      transform:skew(-8deg);
      margin:8px 0;
      text-shadow:
        2px 2px 0 var(--blue),
        4px 4px 0 var(--red),
        6px 6px 0 rgba(0,0,0,0.18);
    }

    .subhead{
      text-align:center;
      font-size:13px;
      font-weight:800;
      margin:0 0 12px;
      letter-spacing:.8px;
      text-transform:uppercase;
    }

    .meta{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:12px;
      margin:8px 0 12px;
      flex-wrap:wrap;
    }

    .pill{
      border:1px solid var(--thin);
      padding:6px 10px;
      border-radius:999px;
      font-weight:800;
      text-transform:uppercase;
      background:#fafafa;
    }

    /* =========================
       Auto-scroll stats banner
       ========================= */

    .stats-bar{
      position:relative;
      overflow:hidden;
      border:1px solid var(--thin);
      background:#fafafa;
      margin:14px 0 22px;
      padding:10px 0;
    }

    .stats-track{
      display:inline-flex;
      gap:28px;
      padding-left:100%;
      animation:stats-scroll 45s linear infinite;
    }

    .stats-bar:hover .stats-track{
      animation-play-state:paused;
    }

    .stat{
      font-size:13px;
      font-weight:900;
      white-space:nowrap;
    }

    @keyframes stats-scroll{
      from{ transform:translateX(0); }
      to{ transform:translateX(-100%); }
    }

    @media (prefers-reduced-motion: reduce){
      .stats-track{
        animation:none;
        padding-left:0;
      }
    }

    /* =========================
       Headlines
       ========================= */

    ul{
      list-style:none;
      padding:0;
      margin:0;
    }

    .state-header{
      margin:20px 0 6px;
      font-size:13px;
      font-weight:900;
      letter-spacing:1px;
      text-transform:uppercase;
    }

    .headline-item{
      margin:0 0 14px;
      padding-left:14px;
      font-size:17px;
      line-height:1.25;
      position:relative;
    }

    .headline-item::before{
      content:"–";
      position:absolute;
      left:0;
      color:#999;
      font-weight:900;
    }

    a{
      color:#000;
      text-decoration:underline;
      font-weight:900;
      word-break:break-word;
    }

    a:hover{ color:#0033cc; }

    .footer{
      text-align:center;
      margin-top:26px;
      font-size:13px;
      color:var(--muted);
    }

    @media (min-width:700px){
      body{ padding:20px; }
      h1{ font-size:54px; }
      .subhead{ font-size:16px; }
      .headline-item{ font-size:18px; }
    }
  </style>
</head>

<body>
  <h1>BLACK MARKET BRIEF</h1>
  <div class="subhead">Disrupting the Illegal Chinese Vape Supply Chain • Protecting Communities</div>

  <div class="meta">
    <div class="pill">Live Desk</div>
    <div id="last-updated">Updated: —</div>
  </div>

  <!-- Auto-scroll stats banner -->
  <div id="stats-bar" class="stats-bar">
    <div id="stats-track" class="stats-track">
      <div class="stat">Loading totals…</div>
    </div>
  </div>

  <!-- Headlines -->
  <ul id="headline-list">
    <li>Loading headlines…</li>
  </ul>

  <script>
    const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTz6qSLgIjDAsDkravmNu3PKrXbDHyGfKHAEY5r0Tyg0ot0co7rCX_S0Y5XtDgOQ34q0DBH1o1tRbbE/pub?output=tsv";
    const STATS_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTz6qSLgIjDAsDkravmNu3PKrXbDHyGfKHAEY5r0Tyg0ot0co7rCX_S0Y5XtDgOQ34q0DBH1o1tRbbE/pub?gid=1186883001&single=true&output=tsv";
    const SUMMARY_ROW_INDEX = 180;

    function splitTSV(line){
      return line.split("\t").map(v => (v||"").trim().replace(/^"|"$/g,""));
    }

    function parseTSV(text){
      const lines = text.trim().split(/\r?\n/);
      const headers = splitTSV(lines[0]).map(h => h.toLowerCase());
      const t = headers.indexOf("article title");
      const l = headers.indexOf("link");
      const s = headers.indexOf("state");

      return lines.slice(1).map(r => {
        const c = splitTSV(r);
        return { title:c[t], url:c[l], state:c[s]||"Unknown" };
      }).filter(x => x.title && x.url);
    }

    function normalizeState(s){
      return (s||"Unknown").trim() || "Unknown";
    }

    /* Load stats banner */
    fetch(STATS_URL)
      .then(r=>r.text())
      .then(t=>{
        const row = t.trim().split(/\r?\n/)[SUMMARY_ROW_INDEX];
        if(!row) return;
        const stats = splitTSV(row).filter(Boolean);
        const track = document.getElementById("stats-track");
        track.innerHTML="";
        [...stats, ...stats].forEach(txt=>{
          const d=document.createElement("div");
          d.className="stat";
          d.textContent=txt;
          track.appendChild(d);
        });
      });

    /* Load headlines */
    fetch(SHEET_URL)
      .then(r=>r.text())
      .then(t=>{
        const entries=parseTSV(t).slice(0,500);
        entries.sort((a,b)=>{
          const sa=normalizeState(a.state), sb=normalizeState(b.state);
          if(sa==="National"&&sb!=="National")return-1;
          if(sb==="National"&&sa!=="National")return 1;
          if(sa!==sb)return sa.localeCompare(sb);
          return a.title.localeCompare(b.title);
        });

        const list=document.getElementById("headline-list");
        list.innerHTML="";
        let cur=null;

        entries.forEach(e=>{
          const st=normalizeState(e.state);
          if(st!==cur){
            cur=st;
            const h=document.createElement("li");
            h.className="state-header";
            h.textContent=st;
            list.appendChild(h);
          }
          const li=document.createElement("li");
          li.className="headline-item";
